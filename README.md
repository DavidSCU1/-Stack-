# 基于栈的表达式计算器

## 项目简介

这是一个基于栈数据结构的C++表达式计算器，使用双栈算法实现中缀表达式的计算。项目完全按照技术架构文档的规范实现，支持多种运算符和复杂表达式计算。

## 功能特性

### 支持的运算符
- `+` : 加法
- `-` : 减法  
- `*` : 乘法
- `/` : 除法
- `%` : 求模
- `^` : 乘方 (例: 2^3 = 8)
- `&` : 开方 (例: 3&8 = 2, 表示8的3次方根)
- `()` : 括号，改变运算优先级

### 支持特性
- ✅ 负数运算 (例: -5 + 3)
- ✅ 小数运算 (例: 3.14 * 2)
- ✅ 括号嵌套 (例: ((2+3)*4))
- ✅ 运算符优先级处理
- ✅ 错误检测和提示
- ✅ 友好的用户界面

## 项目结构

```
Stack/
├── .trae/
│   └── documents/
│       ├── 产品需求文档.md
│       └── 技术架构文档.md
├── LStack.h              # 链式栈数据结构
├── ExpressionCalculator.h # 表达式计算器头文件
├── ExpressionCalculator.cpp # 表达式计算器实现
├── main.cpp              # 主程序
├── test.cpp              # 测试程序
├── build.bat             # 编译脚本
├── run.bat               # 运行脚本
├── test_build.bat        # 测试编译脚本
└── README.md             # 项目说明
```

## 编译和运行

### 方法一：使用批处理脚本（推荐）

1. **编译项目**
   ```bash
   build.bat
   ```

2. **运行程序**
   ```bash
   run.bat
   ```

3. **运行测试**
   ```bash
   test_build.bat
   ```

### 方法二：手动编译

```bash
# 编译主程序
g++ -std=c++17 -Wall -Wextra -O2 -o calculator.exe main.cpp ExpressionCalculator.cpp

# 编译测试程序
g++ -std=c++17 -Wall -Wextra -O2 -o test.exe test.cpp ExpressionCalculator.cpp

# 运行程序
./calculator.exe

# 运行测试
./test.exe
```

## 使用方法

1. 启动程序后，输入数学表达式
2. 表达式必须以 `=` 结尾
3. 支持的命令：
   - `help` - 查看详细帮助
   - `quit` - 退出程序
   - `clear` - 清屏

### 使用示例

```
请输入表达式: 2 + 3 * 4 =
计算结果：14

请输入表达式: (2 + 3) * 4 =
计算结果：20

请输入表达式: 2 ^ 3 =
计算结果：8

请输入表达式: 3 & 27 =
计算结果：3

请输入表达式: -5.5 + 2.3 =
计算结果：-3.2
```

## 技术实现

### 核心算法
- **双栈算法**：使用运算符栈(optr)和操作数栈(opnd)
- **优先级处理**：实现栈内优先级(isp)和栈外优先级(osp)
- **括号匹配**：支持多层嵌套括号

### 核心函数
- `int isp(char ch)` - 获取栈内优先级
- `int osp(char ch)` - 获取栈外优先级
- `bool cal(char op, double x, double y, double &r)` - 执行计算
- `void GetNextchar(char &ch)` - 获取下一个字符
- `bool isdigit(char ch)` - 判断是否为数字
- `bool IsOperator(char ch)` - 判断是否为运算符
- `bool Get2Operands(LStack<double> &opnd, double &x, double &y)` - 取操作数

### 数据结构
- **LStack<T>**：泛型链式栈，支持任意类型数据
- **运算符优先级表**：定义各运算符的优先级关系

## 测试覆盖

项目包含全面的测试用例：
- ✅ 基本四则运算
- ✅ 运算符优先级
- ✅ 括号嵌套
- ✅ 乘方和开方
- ✅ 小数和负数
- ✅ 复杂表达式
- ✅ 错误情况处理

## 错误处理

程序能够检测并处理以下错误：
- 除零错误
- 括号不匹配
- 非法字符
- 表达式格式错误
- 操作数不足
- 负数开方等数学错误

## 开发环境

- **语言**：C++17
- **编译器**：GCC/MinGW (支持MSVC/Clang)
- **平台**：Windows (可移植到Linux/macOS)
- **依赖**：仅使用标准C++库

## 项目特点

1. **完全符合规范**：严格按照技术架构文档实现
2. **代码质量高**：包含完整的错误处理和测试
3. **用户友好**：提供清晰的界面和帮助信息
4. **可扩展性强**：模块化设计，易于添加新功能
5. **性能优秀**：使用高效的栈数据结构

## 许可证

本项目仅供学习和研究使用。